---
name: tools
description: Sets up and maintains an internal dev tooling package in a bun workspace monorepo. Handles code generation scripts, workspace utilities, build helpers, release automation, and shared development scripts. Use when creating a tools package, adding codegen scripts, building workspace utilities, or setting up release automation.
allowed-tools: Read Write Edit Glob Grep Bash
---

# Tools

The `tools` package is an internal dev tooling package that other workspace packages depend on for code generation, build scripts, formatting, and workspace management. It is not published — it exists to automate repetitive tasks across the monorepo.

## Decision Tree

- What are you doing?
  - **Creating a tools package from scratch** → see "Initial setup" below
  - **Adding a code generation script** → see "Code generation" below
  - **Adding a workspace utility** → see "Workspace utilities" below
  - **Adding a build or release script** → see "Build and release" below
  - **Listing all available scripts** → run `tools/script-list.ts`
  - **Checking script health** → run `tools/script-audit.ts`

## Initial setup

1. Create `packages/tools/` in the workspace root
2. Add `package.json`:
   ```json
   {
     "name": "@<project>/tools",
     "private": true,
     "type": "module",
     "bin": {},
     "scripts": {}
   }
   ```
3. Create the directory structure
4. Add to workspace in root `package.json`:
   ```json
   { "workspaces": ["packages/*", "apps/*"] }
   ```
5. Other packages depend on it: `"@<project>/tools": "workspace:*"`

## Directory structure

```
packages/tools/
  src/
    codegen/             # Code generation scripts
      generate-types.ts  # Generate types from schema
      generate-routes.ts # Generate route manifest
    workspace/           # Workspace-wide utilities
      check-deps.ts      # Check dependency versions
      sync-config.ts     # Sync tsconfig/biome across packages
    build/               # Build and release helpers
      version-bump.ts    # Bump versions across packages
      changelog.ts       # Generate changelog from commits
    lib/                 # Shared helpers used by scripts
      workspace.ts       # Find workspace root, list packages
      git.ts             # Git helpers (tags, commits, diffs)
      fs.ts              # File system helpers
  package.json
```

## Script conventions

Every script follows the same pattern:

```ts
const args = Bun.argv.slice(2);

const HELP = `
script-name — One-line description

Usage:
  bun run src/codegen/script-name.ts [options]

Options:
  --dry-run   Show what would be done without writing files
  --json      Output as JSON
  --help      Show this help message
`.trim();

if (args.includes("--help")) {
  console.log(HELP);
  process.exit(0);
}

const dryRun = args.includes("--dry-run");
const jsonOutput = args.includes("--json");

async function main() {
  // implementation
}

main().catch((err) => {
  console.error(`Error: ${err.message}`);
  process.exit(1);
});
```

- Every script has `--help`
- Every script that writes files has `--dry-run`
- Every script that outputs data has `--json`
- Scripts are self-contained — no build step needed, run directly with `bun run`
- Zero external dependencies — use Bun APIs (`Bun.file`, `Bun.Glob`, `Bun.spawn`)

## Code generation

Code generation scripts read source-of-truth files (schemas, configs, route definitions) and output generated code. Always include a header comment in generated files:

```ts
const GENERATED_HEADER = `// This file is auto-generated by @<project>/tools — do not edit manually\n\n`;
```

### Common codegen patterns

- **Types from schema**: read Drizzle schema or Zod schemas, emit TypeScript interfaces
- **Route manifest**: scan file-based routes, emit a typed route map
- **API client**: read OpenAPI spec or route definitions, emit typed fetch wrappers
- **Barrel files**: scan a directory, generate `index.ts` that re-exports everything

Example codegen script:

```ts
async function generateBarrel(dir: string, outFile: string) {
  const glob = new Bun.Glob("*.ts");
  const files: string[] = [];

  for await (const file of glob.scan({ cwd: dir })) {
    if (file === "index.ts") continue;
    files.push(file.replace(".ts", ""));
  }

  files.sort();
  const content = GENERATED_HEADER +
    files.map((f) => `export * from "./${f}";`).join("\n") + "\n";

  if (dryRun) {
    console.log(`Would write ${outFile}:\n${content}`);
    return;
  }

  await Bun.write(outFile, content);
  console.log(`Generated ${outFile} (${files.length} exports)`);
}
```

## Workspace utilities

Scripts that operate across the entire monorepo:

### Find workspace packages

```ts
import { join } from "path";

interface WorkspacePackage {
  name: string;
  path: string;
  version: string;
  private: boolean;
  dependencies: Record<string, string>;
}

async function listPackages(root: string): Promise<WorkspacePackage[]> {
  const rootPkg = await Bun.file(join(root, "package.json")).json();
  const patterns = rootPkg.workspaces || [];
  const packages: WorkspacePackage[] = [];

  for (const pattern of patterns) {
    const glob = new Bun.Glob(join(pattern, "package.json"));
    for await (const file of glob.scan({ cwd: root })) {
      const pkg = await Bun.file(join(root, file)).json();
      packages.push({
        name: pkg.name,
        path: join(root, file.replace("/package.json", "")),
        version: pkg.version || "0.0.0",
        private: pkg.private || false,
        dependencies: { ...pkg.dependencies, ...pkg.devDependencies },
      });
    }
  }

  return packages;
}
```

### Common workspace utilities

- **Dependency sync**: check that shared dependencies use the same version across packages
- **Config sync**: copy or merge `tsconfig.json`, `biome.json` from a template to all packages
- **Unused dependency check**: find `dependencies` entries that aren't imported anywhere
- **Workspace graph**: show which packages depend on which

## Build and release

### Version bumping

```ts
// Read current version, bump based on conventional commits since last tag
async function bumpVersion(type: "patch" | "minor" | "major") {
  const pkg = await Bun.file("package.json").json();
  const [major, minor, patch] = pkg.version.split(".").map(Number);

  const next = type === "major"
    ? `${major + 1}.0.0`
    : type === "minor"
      ? `${major}.${minor + 1}.0`
      : `${major}.${minor}.${patch + 1}`;

  pkg.version = next;
  await Bun.write("package.json", JSON.stringify(pkg, null, 2) + "\n");
  return next;
}
```

### Changelog generation

Read conventional commits since the last git tag, group by type, output markdown.

## Exposing scripts

Register scripts in `package.json` for easy access:

```json
{
  "scripts": {
    "gen:types": "bun run src/codegen/generate-types.ts",
    "gen:routes": "bun run src/codegen/generate-routes.ts",
    "check:deps": "bun run src/workspace/check-deps.ts",
    "sync:config": "bun run src/workspace/sync-config.ts",
    "version:bump": "bun run src/build/version-bump.ts"
  }
}
```

Other packages can reference these from their own scripts:

```json
{
  "scripts": {
    "gen": "bun run --filter @<project>/tools gen:types"
  }
}
```

## Key references

| File | What it covers |
|---|---|
| `tools/script-list.ts` | List all scripts in the tools package with descriptions |
| `tools/script-audit.ts` | Check that all scripts have --help, --json, and --dry-run flags |
